/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package Controllers;

import Model.Order1;
import Model.OrderDetail;
import Model.User;

/**
 *
 * @author usuario
 */
public class MailsController {
    public static void SendEMail(Order1 order, User user) {
        String bodyHtmlTemplate = "<!DOCTYPE html PUBLIC \\\"-//W3C//DTD XHTML 1.0 Transitional//EN\\\" \\\"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\\\"><html xmlns=\\\"http://www.w3.org/1999/xhtml\\\"><head><meta http-equiv=\\\"Content-Type\\\" content=\\\"text/html; charset=utf-8\\\"/><meta name=\\\"viewport\\\" content=\\\"width=device-width, initial-scale=1, maximum-scale=1\\\"/><title>Newsletter</title><style type=\\\"text/css\\\"> body{width:100% !important;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;margin:0;padding:0;background:#ffffff}*{-webkit-font-smoothing:antialiased}.ExternalClass *{line-height:100%}table td{border-collapse:collapse}*[class].wlf{width:600px}*[class].w-280{width:280px}*[class].w-200{width:200px}*[class].w-150{width:150px}*[class].w-130{width:130px}*[class].w-120{width:120px}*[class].w-30{width:30px}@media only screen and (max-width:600px){*[class].full-width{width:100% !important}*[class].m-width{width:100% !important;max-width:100% !important}}</style></head><body><table width=\\\"100%\\\" bgcolor=\\\"#ffffff\\\" border=\\\"0\\\" cellspacing=\\\"0\\\" cellpadding=\\\"0\\\" style=\\\"table-layout:fixed\\\"><tr><td><table class=\\\"wlf full-width\\\" width=\\\"100%\\\" border=\\\"0\\\" cellspacing=\\\"0\\\" cellpadding=\\\"0\\\" align=\\\"center\\\" style=\\\"margin:0 auto;max-width:600px\\\"> <tr> <td> <table width=\\\"100%\\\" border=\\\"0\\\" cellspacing=\\\"0\\\" cellpadding=\\\"0\\\"> <tr> <td width=\\\"14%\\\">&nbsp;</td><td> <table width=\\\"100%\\\" border=\\\"0\\\" cellspacing=\\\"0\\\" cellpadding=\\\"0\\\"> <tr> <td style=\\\"color:#4EC67F;font-family:Arial, sans-serif;font-size:30px;font-weight:bold;line-height:34px\\\">FarmaciasYA!</td></tr><tr> <td style=\\\"color:#666666;font-family:Arial, sans-serif;font-size:18px;line-height:22px\\\">Se ha realizado la compra con \\u00E9xito. En breve le enviaremos su pedido</td></tr><tr> <td height=\\\"50\\\">&nbsp;</td></tr></table> </td><td width=\\\"14%\\\">&nbsp;</td></tr></table> <table width=\\\"100%\\\" bgcolor=\\\"#4EC67F\\\" border=\\\"0\\\" cellspacing=\\\"0\\\" cellpadding=\\\"0\\\"> <tr> <td height=\\\"40\\\">&nbsp;</td></tr><tr> <td>{{cart_item.products}}</td></tr></table> <table width=\\\"100%\\\" border=\\\"0\\\" cellspacing=\\\"0\\\" cellpadding=\\\"0\\\"> <tr> <td height=\\\"25\\\">&nbsp;</td></tr><tr> <td> <table width=\\\"100%\\\" border=\\\"0\\\" cellspacing=\\\"0\\\" cellpadding=\\\"0\\\"> <tr> <td width=\\\"14%\\\">&nbsp;</td><td width=\\\"150\\\"> <table class=\\\"w-150 m-width\\\" width=\\\"100%\\\" border=\\\"0\\\" cellspacing=\\\"0\\\" cellpadding=\\\"0\\\" align=\\\"left\\\" style=\\\"max-width:150px\\\"> <tr> <td height=\\\"1\\\" style=\\\"font-size:1px;line-height:1px\\\">&nbsp;</td></tr></table> <table class=\\\"w-200 m-width\\\" width=\\\"100%\\\" border=\\\"0\\\" cellspacing=\\\"0\\\" cellpadding=\\\"0\\\" align=\\\"left\\\" style=\\\"max-width:200px\\\"> <tr> <td style=\\\"color:#666666;font-family:Arial, sans-serif;font-size:18px;font-weight:bold;line-height:22px\\\">Subtotal: ${{cart_data.value|cents_to_dollars}}</td></tr><tr> <td height=\\\"7\\\" style=\\\"font-size:1px;line-height:1px\\\">&nbsp;</td></tr></table> </td><td width=\\\"14%\\\">&nbsp;</td></tr></table> </td></tr><tr> <td height=\\\"60\\\">&nbsp;</td></tr></table> <table width=\\\"100%\\\" border=\\\"0\\\" cellspacing=\\\"0\\\" cellpadding=\\\"0\\\"> <tr> <td align=\\\"center\\\" style=\\\"font-size:1px;line-height:1px\\\"><img src=\\\"https://s3.amazonaws.com/rejoiner/generic/b/div.png\\\" width=\\\"574\\\" alt=\\\"\\\" style=\\\"display:block;width:100%;max-width:574px;max-height:8px\\\"/></td></tr><tr> <td height=\\\"30\\\">&nbsp;</td></tr></table> <table width=\\\"100%\\\" border=\\\"0\\\" cellspacing=\\\"0\\\" cellpadding=\\\"0\\\"> <tr> <td width=\\\"5%\\\">&nbsp;</td><td> <table width=\\\"100%\\\" border=\\\"0\\\" cellspacing=\\\"0\\\" cellpadding=\\\"0\\\"> <tr> <td align=\\\"center\\\" style=\\\"font-family:Arial, sans-serif;font-size:24px;font-weight:bold;line-height:28px\\\"><a href=\\\"#\\\" style=\\\"color:#4EC67F;pointer-events:none;cursor:default;text-decoration:none\\\">+0900 1711</a></td></tr><tr> <td height=\\\"15\\\" style=\\\"font-size:1px;line-height:1px\\\">&nbsp;</td></tr><tr> <td align=\\\"center\\\" style=\\\"color:#666666;font-family:Arial, sans-serif;font-size:11px;line-height:16px\\\">FarmaciasYA! Todos los derechos reservados.</td></tr><tr> <td height=\\\"5\\\" style=\\\"font-size:1px;line-height:1px\\\">&nbsp;</td></tr><tr> <td align=\\\"center\\\" style=\\\"color:#666666;font-family:Arial, sans-serif;font-size:11px;line-height:16px\\\">\\u00BFNecesita ayuda? Cont\\u00E1ctenos! soporte@farmaciaya.com</td></tr><tr> <td height=\\\"5\\\" style=\\\"font-size:1px;line-height:1px\\\">&nbsp;</td></tr></table> </td><td width=\\\"5%\\\">&nbsp;</td></tr></table> </td></tr></table></td></tr></table></body></html>";
        String productHtmlTemplate = "<table width=\\\"100%\\\" border=\\\"0\\\" cellspacing=\\\"0\\\" cellpadding=\\\"0\\\"> <tbody><tr> <td> <table width=\\\"100%\\\" border=\\\"0\\\" cellspacing=\\\"0\\\" cellpadding=\\\"0\\\"> <tbody><tr> <td width=\\\"14%\\\">&nbsp;</td><td width=\\\"120\\\" valign=\\\"top\\\"> <table class=\\\"w-120 m-width\\\" width=\\\"100%\\\" border=\\\"0\\\" cellspacing=\\\"0\\\" cellpadding=\\\"0\\\" align=\\\"left\\\" style=\\\"max-width:120px\\\"> <tbody><tr> <td><a href=\\\"{{cart_data.return_url}}\\\" target=\\\"_blank\\\"><img src=\\\"https://s3.amazonaws.com/rejoiner/generic/b/img-b.png\\\" width=\\\"120\\\" alt=\\\"\\\" style=\\\"display:block;border:none;max-height:200px\\\"></a></td></tr></tbody></table> <table class=\\\"w-30 m-width\\\" width=\\\"100%\\\" border=\\\"0\\\" cellspacing=\\\"0\\\" cellpadding=\\\"0\\\" align=\\\"left\\\" style=\\\"max-width:30px\\\"> <tbody><tr> <td height=\\\"1\\\" style=\\\"font-size:1px;line-height:1px\\\">&nbsp;</td></tr></tbody></table> <table class=\\\"w-280 m-width\\\" width=\\\"100%\\\" border=\\\"0\\\" cellspacing=\\\"0\\\" cellpadding=\\\"0\\\" align=\\\"left\\\" style=\\\"max-width:280px\\\"> <tbody><tr> <td> <table width=\\\"100%\\\" border=\\\"0\\\" cellspacing=\\\"0\\\" cellpadding=\\\"0\\\"> <tbody><tr> <td width=\\\"130\\\" valign=\\\"top\\\"> <table class=\\\"w-130 m-width\\\" width=\\\"100%\\\" border=\\\"0\\\" cellspacing=\\\"0\\\" cellpadding=\\\"0\\\" align=\\\"left\\\" style=\\\"max-width:130px\\\"> <tbody><tr> <td height=\\\"15\\\" style=\\\"font-size:1px;line-height:1px\\\">&nbsp;</td></tr><tr> <td style=\\\"color:#ffffff;font-family:Arial, sans-serif;font-size:14px;font-weight:bold;line-height:18px\\\">{{cart_item.fields.name}}</td></tr></tbody></table> <table class=\\\"w-30 m-width\\\" width=\\\"100%\\\" border=\\\"0\\\" cellspacing=\\\"0\\\" cellpadding=\\\"0\\\" align=\\\"left\\\" style=\\\"max-width:30px\\\"> <tbody><tr> <td height=\\\"1\\\" style=\\\"font-size:1px;line-height:1px\\\">&nbsp;</td></tr></tbody></table> <table class=\\\"w-120 m-width\\\" width=\\\"100%\\\" border=\\\"0\\\" cellspacing=\\\"0\\\" cellpadding=\\\"0\\\" align=\\\"left\\\" style=\\\"max-width:120px\\\"> <tbody><tr> <td height=\\\"15\\\" style=\\\"font-size:1px;line-height:1px\\\">&nbsp;</td></tr><tr> <td style=\\\"color:#ffffff;font-family:Arial, sans-serif;font-size:14px;font-weight:bold;line-height:18px\\\">Qty:{{cart_item.fields.item_qty}}</td></tr><tr> <td height=\\\"10\\\" style=\\\"font-size:1px;line-height:1px\\\">&nbsp;</td></tr><tr> <td style=\\\"color:#ffffff;font-family:Arial, sans-serif;font-size:14px;font-weight:bold;line-height:18px\\\">Price: ${{cart_item.fields.price}}</td></tr></tbody></table> </td></tr></tbody></table> </td></tr><tr> <td height=\\\"15\\\" style=\\\"font-size:1px;line-height:1px\\\">&nbsp;</td></tr></tbody></table> </td><td width=\\\"14%\\\">&nbsp;</td></tr></tbody></table> </td></tr><tr> <td height=\\\"40\\\">&nbsp;</td></tr></tbody></table>";

        StringBuilder sbProductsHtml = new StringBuilder();

        try {
            for (OrderDetail orderDetail : order.getOrderDetailCollection()) {
                String productHtml = productHtmlTemplate.replace("{{cart_item.fields.name}}", orderDetail.getIdProdutDrugStore().getIdProduct().getName())
                                                        .replace("{{cart_item.fields.item_qty}}", orderDetail.getQuantity().toString())
                                                        .replace("{{cart_item.fields.price}}", orderDetail.getPrice().toString());
                sbProductsHtml.append(productHtml);
            }
        } catch(Exception e) {
            e.printStackTrace();
        }

        String productsHtml = sbProductsHtml.toString();
        String body = bodyHtmlTemplate.replace("{{cart_item.products}}", productsHtml);

        Utils.Mail.sendMail(user.getEmail(), "FarmaciasYA! Compra confirmada.", body);
    }
}
